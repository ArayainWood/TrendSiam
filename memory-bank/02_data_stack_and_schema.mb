2025-09-30: Added: psql-runner + preflight/dry-run/exec/post-verify.
• Database: Supabase Postgres.
• Time policy: store timestamps in UTC; present/filter "today" using Asia/Bangkok at the view layer.
• Key tables (indicative):
  • news_trends: normalized items across platforms (id, platform, external_id, title, summary, category, engagement metrics, captured_at_utc, summary_at_utc, ai_image_prompt/url, popularity_score, keywords, ai_opinion, source_url).
  • users (auth via Supabase), profiles (role: free/premium).
• Public views (examples): public_v_home_news, public_v_weekly_stats, public_v_weekly_snapshots. Add new public_v_* for stable frontend reading.
• Indices & constraints: uniqueness on (platform, external_id); dedupe logic; not null constraints on essential fields.
• Data contracts: frontend consumes public views only. If a column name changes, retain a legacy alias in the view.
• Schema rules for SQL changes:
  • Always use schema-qualified names (public.table_name, never just table_name)
  • Use idempotent DDL patterns: CREATE TABLE IF NOT EXISTS, CREATE OR REPLACE VIEW, DROP IF EXISTS
  • Naming conventions: tables/views in snake_case, prefix views with public_v_, indexes with idx_
  • Avoid destructive changes without backup verification
• Current home view: public.home_feed_v1 (created 2025-09-30, completely fixed 2025-10-04)
  • Primary source: news_trends table (237 rows with valid identifiers)
  • source_url generation: robust identification via external_id/video_id presence (not platform name)
  • platform normalization: auto-detects YouTube from identifiers, corrects channel names
  • score_details: kept as TEXT type (not jsonb) - contains descriptive text
  • Ranking: popularity_score DESC, created_at DESC, id (deterministic tiebreaker)
  • Filters: requires title + at least one identifier (external_id, video_id, or source_url)
  • Demo fallback: removed from view (use dev feature flag if needed in API layer)
