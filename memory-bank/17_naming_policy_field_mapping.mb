• **Naming & Schema Policy** (Established 2025-10-09 - Phase 7 Naming Audit)

## Standards
- **Database (SQL, views, RPC)**: snake_case ONLY
- **Frontend (TypeScript, React)**: camelCase ONLY  
- **Python (ETL, scripts)**: snake_case ONLY
- **Environment variables**: SCREAMING_SNAKE_CASE

## Golden Rules
1. **NO DUPLICATES**: Before adding any field, search entire codebase for similar names
2. **Compatibility aliases**: Use view-layer aliases for backward compatibility instead of duplicating columns
3. **Centralized mapping**: All DB↔FE transformations happen in `frontend/src/lib/mapNews.ts`
4. **Type safety**: Zod schemas enforce structure; optional fields use `.nullable().optional()`
5. **Version bumps**: Every schema change updates `system_meta.home_view_version`

## Reserved Names (DO NOT REUSE)
**Identity**: id, story_id, video_id, external_id  
**Platform metrics**: views, video_views, view_count, likes, like_count, comments, comment_count  
**Site metrics**: web_view_count, site_click_count  
**Timestamps**: published_at, snapshot_date, created_at, updated_at  
**Scoring**: popularity_score, rank, is_top3, score_details  
**Images**: ai_image_url, ai_prompt, image_url, show_image, show_ai_prompt

## Resolved Ambiguities
**views vs video_views vs web_view_count**:
- `video_views` (DB) / `videoViews` (FE) = YouTube/platform views (CANONICAL)
- `views` = Legacy alias for backward compatibility (DEPRECATED in new code)
- `web_view_count` (DB) / `webViewCount` (FE) = TrendSiam site clicks

**published_at vs snapshot_date** (CRITICAL - Updated 2025-10-10):
- `published_at` = Platform's original publish date (YouTube upload date)
  - USE FOR: Display-only (Story Details "Published" label)
  - NEVER USE FOR: Ranking, filtering, determining "today"
  - Fallback: If NULL, show placeholder "—" (do NOT substitute with snapshot_date or created_at)
- `snapshot_date` = Our ingestion/capture date (Thai TZ)
  - USE FOR: Filtering/ranking ONLY (determining "today's snapshot")
  - NEVER USE FOR: Display in UI (internal use only)
  - Source: `news_trends.date` (if exists) or computed from `created_at AT TIME ZONE 'Asia/Bangkok'`
- WHY BOTH: Old viral content (published weeks ago) should appear on home if ingested today
  - Home ranking: Uses snapshot_date (when we captured)
  - Story Details: Shows published_at (when platform published)

**ai_image_url historical misnaming**:
- `ai_generated_image` = True AI-generated image from public_v_ai_images_latest
- `platform_thumbnail` = Platform thumbnail from news_trends.ai_image_url
- `image_url` (FE) = COALESCE(ai_generated_image, platform_thumbnail)

**platform_mentions type**:
- Type is TEXT (descriptive), NOT integer despite name suggesting count
- Contains: "Facebook, Instagram, Twitter/X, TikTok..." lists
- Never cast to integer

## Change Process
1. **Search**: `grep -r "proposed_name" . --exclude-dir={node_modules,.next}`
2. **Check duplicates**: Ensure no similar/conflicting names exist
3. **Add to DB**: Idempotent migration, nullable or default value
4. **Update view**: Add to public_v_home_news SELECT with DEFINER security
5. **Bump version**: `system_meta.home_view_version = '2025-MM-DD_description'`
6. **Add mapping**: Update mapNews.ts with snake_case → camelCase
7. **Add schema**: Update Zod schemas with `.nullable().optional()`
8. **Update docs**: Add row to DB_FE_FIELD_MAPPING.md
9. **Update Memory Bank**: Document change here

## Canonical Reference
**Full documentation**: `DB_FE_FIELD_MAPPING.md` (400+ lines)
- 40+ fields mapped with DB name, FE name, type, source, notes
- Complete field map table
- Type transformation rules
- Known gotchas and edge cases

**Last audit**: 2025-10-09 (Phase 7 comprehensive naming audit)  
**Status**: Active policy, mandatory for all schema changes  
**Exceptions**: Require lead approval with justification

